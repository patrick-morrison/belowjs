<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Measurement Viewer</title>
    
    <!-- BelowJS Production Build -->
    <link rel="stylesheet" href="/dist/belowjs.css">
    
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* Hide dive mode toggle - measurement only */
        #modeToggleContainer,
        .semantic-toggle {
            display: none !important;
        }
    </style>
</head>
<body>
    <script type="module">
        import { ModelViewer } from '/dist/belowjs.es.js';

        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const modelUrl = urlParams.get('model') || '../basic-viewer/models/unknown.glb';
        const modelName = urlParams.get('name') || 'Unknown Wreck';
        const cameraX = parseFloat(urlParams.get('cx')) || 34.226;
        const cameraY = parseFloat(urlParams.get('cy')) || 10.354;
        const cameraZ = parseFloat(urlParams.get('cz')) || 2.12;
        const targetX = parseFloat(urlParams.get('tx')) || 10.959;
        const targetY = parseFloat(urlParams.get('ty')) || -1.07;
        const targetZ = parseFloat(urlParams.get('tz')) || 2.247;
        const backgroundColor = urlParams.get('bg') || '#f8f9fa';
        const credit = urlParams.get('credit') || '';

        // Dynamic model configuration based on URL parameters
        const models = {
          'model': { 
            url: modelUrl, 
            name: modelName,
            credit: credit,
            initialPositions: {
              desktop: {
                camera: { x: cameraX, y: cameraY, z: cameraZ },
                target: { x: targetX, y: targetY, z: targetZ }
              }
            }
          }
        };

        // Create viewer container
        const viewerContainer = document.createElement('div');
        viewerContainer.style.position = 'fixed';
        viewerContainer.style.inset = '0';
        viewerContainer.style.zIndex = '0';
        document.body.appendChild(viewerContainer);

        // Light measurement viewer: clean, bright, measurement-focused
        const viewer = new ModelViewer(viewerContainer, {
          models: models,
          enableMeasurement: true,
          measurementTheme: 'light', // Use light theme for measurement panel
          enableDiveSystem: true, // Enable dive system for survey lighting
          enableFullscreen: true,
          autoLoadFirst: true,
          showInfo: false,
          showStatus: false,
          showLoadingIndicator: false,
          enableVRAudio: false, // Disable VR audio to prevent 404 errors
          viewerConfig: {
            scene: {
              background: { type: 'color', value: backgroundColor }, // Configurable background 
              fog: { enabled: false }
            },
            camera: {
              fov: 65,
              near: 0.05,
              far: 2000
            }
          }
        });
    </script>
</body>
</html>